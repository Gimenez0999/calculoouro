<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Calculadora de Ouro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    margin: 0;
    background-color: #4B0000;
    font-family: 'Montserrat', sans-serif;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
.calculadora {
    position: relative; /* para posicionar o balão internamente */
    border: 4px solid #FFD700;
    border-radius: 20px;
    padding: 40px;
    background-color: #4B0000;
    color: #FFD700;
    width: 100%;
    max-width: 420px;
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
    text-align: center;
}
h2 { font-size: 28px; margin-bottom: 20px; }
label { display: block; margin-bottom: 8px; font-size: 16px; text-align: left; }
select, input[type="number"] {
    width: 100%; padding: 12px; margin-bottom: 20px;
    border: 2px solid #FFD700; border-radius: 10px;
    background-color: #fff8dc; color: #4B0000;
    font-weight: bold; font-size: 16px;
    outline: none;
    transition: box-shadow .2s ease, border-color .2s ease;
}
select.erro, input.erro {
    border-color: #ff4d4d;
    box-shadow: 0 0 0 3px rgba(255, 77, 77, .25);
}
.mensagem-info { font-size: 14px; margin-bottom: 10px; color: #FFD700; }
.btn-calcular {
    background-color: #FFD700; color: #4B0000;
    padding: 15px; border: none; border-radius: 12px;
    font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.3s ease;
    width: 100%;
}
.btn-calcular:hover { background-color: #28a745; color: #fff; }
.resultado {
    margin-top: 20px; font-size: 22px; background-color: #fff8dc;
    color: #4B0000; padding: 15px; border-radius: 12px; border: 2px solid #FFD700;
}

/* ---- Balão de aviso (toast) ---- */
.balao {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    top: -12px; /* aparece “por cima” do conteúdo */
    background: #fff8dc;
    color: #4B0000;
    border: 2px solid #FFD700;
    border-radius: 12px;
    padding: 10px 14px;
    font-size: 14px;
    box-shadow: 0 8px 20px rgba(0,0,0,.25);
    opacity: 0;
    pointer-events: none;
    transition: opacity .25s ease, transform .25s ease;
    z-index: 5;
}
.balao:after {
    content: "";
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    border-width: 8px;
    border-style: solid;
    border-color: #FFD700 transparent transparent transparent; /* borda externa (dourada) */
}
.balao:before {
    content: "";
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translateX(-50%);
    border-width: 6px;
    border-style: solid;
    border-color: #fff8dc transparent transparent transparent; /* triângulo interno (cor de fundo) */
    z-index: 1;
}
.balao.mostrar {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    pointer-events: auto;
}

/* espaço para o balão não cobrir o título */
.calculadora { padding-top: 56px; }
</style>
</head>
<body>
<div class="calculadora">
    <!-- Balão de mensagem -->
    <div id="balao" class="balao" role="alert" aria-live="polite" aria-atomic="true" style="display:none;"></div>

    <h2>Calculadora de Ouro</h2>

    <label for="tipoOuro">Tipo de Ouro:</label>
    <select id="tipoOuro">
        <option value="">Selecione</option>
        <option value="24">24K</option>
        <option value="22">22K</option>
        <option value="18">18K</option>
        <option value="14">14K</option>
        <option value="10">10K</option>
    </select>

    <label for="peso">Peso (gramas):</label>
    <input type="number" id="peso" placeholder="Digite o peso" inputmode="decimal" />

    <div class="mensagem-info">Saiba agora o preço e fale no WhatsApp.</div>
    <button class="btn-calcular" id="btnCalcular">Calcular e Enviar WhatsApp</button>
    <div class="resultado" id="resultado">R$ 0,00</div>
</div>

<script>
const valoresBase = {
    "24": 485.71,
    "22": 427.42,
    "18": 340.00,
    "14": 218.57,
    "10": 72.86
};

const teorEl = document.getElementById("tipoOuro");
const pesoEl = document.getElementById("peso");
const resultadoDiv = document.getElementById("resultado");
const balao = document.getElementById("balao");
const btn = document.getElementById("btnCalcular");

let balaoTimeout;

/** Mostra balão de aviso no topo da calculadora */
function showBalao(msg, ms = 3500) {
    balao.textContent = msg;
    balao.style.display = 'block';
    requestAnimationFrame(() => balao.classList.add('mostrar'));
    clearTimeout(balaoTimeout);
    balaoTimeout = setTimeout(hideBalao, ms);
}
function hideBalao() {
    balao.classList.remove('mostrar');
    // espera a transição terminar antes de esconder
    setTimeout(() => { balao.style.display = 'none'; }, 250);
}

/** Limpa destaque de erro quando o usuário preenche */
[teorEl, pesoEl].forEach(el => {
    el.addEventListener('input', () => el.classList.remove('erro'));
});

/** Validação simples sem alert e sem validação nativa do navegador */
function validarCampos() {
    let ok = true;
    // limpar estados anteriores
    teorEl.classList.remove('erro');
    pesoEl.classList.remove('erro');

    const teor = teorEl.value;
    const peso = parseFloat(pesoEl.value.replace(',', '.'));

    if (!teor && (isNaN(peso) || peso <= 0)) {
        showBalao('Por favor, selecione o teor e informe o peso.');
        teorEl.classList.add('erro');
        pesoEl.classList.add('erro');
        if (!teor) teorEl.focus();
        ok = false;
    } else if (!teor) {
        showBalao('Selecione o teor (ex.: 18K, 22K).');
        teorEl.classList.add('erro');
        teorEl.focus();
        ok = false;
    } else if (isNaN(peso) || peso <= 0) {
        showBalao('Informe o peso em gramas (maior que zero).');
        pesoEl.classList.add('erro');
        pesoEl.focus();
        ok = false;
    }
    return ok;
}

function calcular() {
    if (!validarCampos()) return;

    const teor = teorEl.value;
    const peso = parseFloat(pesoEl.value.replace(',', '.'));

    const valorUnitario = valoresBase[teor];
    const total = (valorUnitario * peso).toFixed(2);
    resultadoDiv.innerText = "R$ " + total.replace(".", ",");

    // Envia mensagem para o site (ex: Wix / GTM)
    if (window.parent) {
        window.parent.postMessage({
            event: 'clique_whatsapp',
            categoria: 'CalculadoraOuro',
            label: 'Botão Calcular e Enviar WhatsApp'
        }, '*');
    }

    // Abre WhatsApp
    const mensagem = `Olá! Tenho ${peso.toString().replace('.', ',')}g de ouro ${teor}K. Quanto receberei?\nValor estimado: R$ ${total.replace(".", ",")}`;
    const numeroWhatsApp = "5511989122900";
    const url = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`;
    window.open(url, "_blank");
}

btn.addEventListener('click', calcular);
</script>
</body>
</html>
